---
import BaseLayout from '../layouts/BaseLayout.astro';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import { getCollection } from 'astro:content';

// Get all posts from collections
const allPosts = await Promise.all([
  getCollection('posts'),
  getCollection('java-network-series'),
  getCollection('javascript-network-series')
]).then(collections => collections.flat());

// Sort posts by date (newest first)
const sortedPosts = allPosts.sort((a, b) => {
  const dateA = new Date(a.data.date);
  const dateB = new Date(b.data.date);
  return dateB.getTime() - dateA.getTime();
});

// Format date for display
function formatDate(dateString: string) {
  const date = new Date(dateString);
  return date.toLocaleDateString('vi-VN', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric'
  });
}

// Calculate read time (rough estimate)
function calculateReadTime(content: string) {
  const wordsPerMinute = 200;
  const wordCount = content.split(/\s+/).length;
  const minutes = Math.ceil(wordCount / wordsPerMinute);
  return `${minutes} phút đọc`;
}
---

<BaseLayout title="Blog - Kant Nguyễn">
  <Navbar />
  
  <main class="min-h-screen bg-bgLight dark:bg-bgDark">
    <!-- Hero Section -->
    <section class="py-20 bg-gradient-to-br from-primary/5 to-purple-600/5">
      <div class="max-w-4xl mx-auto px-4 text-center">
        <h1 class="text-4xl md:text-5xl font-bold mb-6 gradient-text">
          Blog của tôi
        </h1>
        <p class="text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
          Chia sẻ kiến thức về Java, Backend Development và Networking
        </p>
      </div>
    </section>

    <!-- Blog Posts -->
    <section class="py-16">
      <div class="max-w-4xl mx-auto px-4">
        <div class="space-y-8">
          {sortedPosts.map(post => (
            <article class="bg-white dark:bg-gray-800 rounded-xl shadow-lg hover:shadow-xl transition-shadow p-6">
              <div class="flex items-start justify-between mb-4">
                <div class="flex-1">
                  <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-3 hover:text-primary transition-colors cursor-pointer">
                    <a href={`/blog/${post.slug}`}>{post.data.title}</a>
                  </h2>
                  <p class="text-gray-600 dark:text-gray-300 mb-4 leading-relaxed">
                    {post.data.description}
                  </p>
                </div>
                {post.data.series && (
                  <span class="ml-4 px-3 py-1 bg-accent text-gray-900 text-sm font-semibold rounded-full">
                    Series
                  </span>
                )}
              </div>
              
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400">
                  <span>{formatDate(post.data.date)}</span>
                  <span>•</span>
                  <span>{calculateReadTime(post.body)}</span>
                </div>
                
                <div class="flex flex-wrap gap-2">
                  {post.data.tags.map(tag => (
                    <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm rounded-md">
                      {tag}
                    </span>
                  ))}
                </div>
              </div>
            </article>
          ))}
        </div>
        
        <!-- Load More Button -->
        <div class="text-center mt-12">
          <button class="px-8 py-3 bg-primary text-white rounded-lg font-semibold hover:bg-primary/90 transform hover:scale-105 transition-all duration-200 shadow-lg hover:shadow-xl">
            Xem thêm bài viết
          </button>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</BaseLayout>